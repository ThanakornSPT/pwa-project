<!DOCTYPE html>
<html lang="th" ng-app="englishPracticeApp">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>English Practice</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vocabulary Learning</title>


    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#b3d9f2">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#b3d9f2">
    <meta name="apple-mobile-web-app-title" content="Create Sentences">
    
    <!-- Additional iOS Status Bar Styling -->
    <meta name="apple-touch-fullscreen" content="yes">
    <meta name="format-detection" content="telephone=no">

    <meta name="theme-color" content="#b3d9f2">
    <meta name=apple-mobile-web-app-capable content=yes>
    <meta name=apple-mobile-web-app-status-bar-style content=black>

    <link rel="manifest" href="./manifest.json">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.8.3/angular.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #b3d9f2 0%, #e6f3ff 100%);
            min-height: 100vh;
            padding: 20px;
            font-family: "Sarabun", sans-serif;
            font-weight: 100;
            font-style: normal;
        }
        
        .container {
            max-width: 600px;
            margin: 0 auto;
        }
        
        .header {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
        }
        
        .dropdown {
            flex: 1;
            background: #f8f9fa;
            border: none;
            border-radius: 10px;
            padding: 20px 20px;
            width: 100%;
            margin-bottom: 20px;
            font-size: 16px;
            color: #495057;
            appearance: none;
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='m6 8 4 4 4-4'/%3e%3c/svg%3e");
            background-position: right 12px center;
            background-repeat: no-repeat;
            background-size: 16px;
        }
        
        .refresh-btn {
            padding: 8px 25px;
            background: #4096d9;
            color: white;
            height: 57px;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        
        .refresh-btn:hover {
            background: #3085c3;
        }
        
        .exercise-item {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            padding: 15px;
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        .hint-btn {
            width: 48px;
            height: 36px;
            background: #4096d9;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 24px;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
            transition: background-color 0.3s ease;
        }
        
        .hint-btn:hover {
            background: #3085c3;
        }
        
        .hint-btn.passed {
            background: #dc3545;
        }
        
        .hint-btn.passed:hover {
            background: #c82333;
        }
        
        .exercise-content {
            flex: 1;
        }
        
        .thai-text {
            font-size: 18px;
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
        }
        
        .english-text {
            color: #b3b3b3;
            font-size: 16px;
            margin-bottom: 15px;
            min-height: 24px;
            font-weight: 200;
            line-height: 2;
        }
        
        .action-buttons {
            display: flex;
            gap: 10px;
            justify-content: space-between;
        }
        
        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            font-weight: bold;
        }
        
        .btn-keep {
            background: #cccccc;
            color: white;
        }
        
        .btn-pass {
            background: #4096d9;
            color: white;
        }
        
        .btn-show {
            background: transparent;
            color: #4096d9;
            border: 1px solid #4096d9;
        }
        
        .btn:hover {
            opacity: 0.8;
        }
        
        .progress-container {
            margin-top: 30px;
            border-radius: 12px;
            padding: 20px;
        }
        
        .progress-bar {
            width: 100%;
            height: 12px;
            background: #c2ddf4;
            border-radius: 6px;
            overflow: hidden;
            margin-bottom: 10px;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4096d9 0%, #7db8e8 100%);
            width: 0%;
            transition: width 0.3s ease;
        }
        
        .progress-text {
            text-align: center;
            font-size: 18px;
            font-weight: 300;
            color: #4096d9;
        }
        
        .invisible-text {
            color: transparent;
            background: #f0f0f0;
            border-radius: 4px;
            padding: 2px 4px;
            margin: 0px 2px;
        }
    </style>
</head>
<body ng-controller="EnglishPracticeController">
    <div class="container">
        <div class="header">
            <select class="dropdown" ng-model="selectedCategory" ng-change="loadExercises()">
                <option ng-repeat="category in categories" value="{{category.value}}">{{category.label}}</option>
            </select>
            <button class="refresh-btn" ng-click="refreshExercises()">REFRESH</button>
        </div>
        
        <div>
            <div class="exercise-item" ng-repeat="exercise in currentExercises track by $index">
                
                <div class="exercise-content">
                    <div class="thai-text">{{exercise.thai}}</div>
                    <div class="english-text" ng-bind-html="getEnglishText($index)"></div>
                    <div class="action-buttons">
                        <div><button class="hint-btn" ng-class="{'passed': passedExercises[$index]}" ng-click="showHint($index)"> {{getHintButtonText($index)}} </button></div>
                        <div>
                        <button class="btn btn-keep" ng-click="keepExercise($index)">KEEP</button>
                        <button class="btn btn-pass" ng-click="passExercise($index)">PASS</button>
                        <button class="btn btn-show" ng-click="showAnswer($index)">SHOW</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="progress-container">
            <div class="progress-bar">
                <div class="progress-fill" ng-style="{'width': getProgressPercentage() + '%'}"></div>
            </div>
            <div class="progress-text">{{getProgressPercentage()}} % | Score: {{totalScore}}</div>
        </div>
    </div>

    <script>
        angular.module('englishPracticeApp', [])
        .filter('trusted', ['$sce', function ($sce) {
            return function(text) {
                return $sce.trustAsHtml(text);
            };
        }])
        .controller('EnglishPracticeController', ['$scope', '$sce', function($scope, $sce) {
            
          
            
            // Exercise data
            $scope.exerciseData = {
                office1: [
  {
    "thai": "ฉันตื่นนอนตอนตี 5 ครึ่งทุกวัน",
    "english": "I wake up at 5:30 AM every day.",
    "words": ["I", "wake", "up", "at", "5:30", "AM", "every", "day." ]
  },
  {
    "thai": "ฉันอาบน้ำและเตรียมตัวสำหรับวันใหม่",
    "english": "I take a shower and get ready for the day.",
    "words": ["I", "take", "a", "shower", "and", "get", "ready", "for", "the", "day." ]
  },
  {
    "thai": "ฉันลงไปซื้อกาแฟร้อนที่ร้านสะดวกซื้อหน้าปากซอย",
    "english": "I go down to buy a hot coffee at the convenience store in front of the alley.",
    "words": ["I", "go", "down", "to", "buy", "a", "hot", "coffee", "at", "the", "convenience", "store", "in", "front", "of", "the", "alley." ]
  },
  {
    "thai": "ฉันดื่มกาแฟในขณะที่เช็คอีเมลงานบนโทรศัพท์",
    "english": "I drink coffee while checking work emails on my phone.",
    "words": ["I", "drink", "coffee", "while", "checking", "work", "emails", "on", "my", "phone." ]
  },
  {
    "thai": "ฉันขึ้น BTS ไปทำงานที่สถานีอโศก",
    "english": "I take the BTS to work at Asok station.",
    "words": ["I", "take", "the", "BTS", "to", "work", "at", "Asok", "station." ]
  },
  {
    "thai": "คนแน่นมาก ๆ ในช่วงชั่วโมงเร่งด่วน",
    "english": "It's very crowded during rush hour.",
    "words": ["It's", "very", "crowded", "during", "rush", "hour." ]
  },
  {
    "thai": "ฉันมาถึงออฟฟิศตอน 8 โมงเช้า",
    "english": "I arrive at the office at 8 AM.",
    "words": ["I", "arrive", "at", "the", "office", "at", "8", "AM." ]
  },
  {
    "thai": "ฉันเริ่มวันทำงานด้วยการวางแผนงาน",
    "english": "I start the workday by planning my tasks.",
    "words": ["I", "start", "the", "workday", "by", "planning", "my", "tasks." ]
  },
  {
    "thai": "ฉันต้องตอบอีเมลหลายฉบับ",
    "english": "I have to reply to many emails.",
    "words": ["I", "have", "to", "reply", "to", "many", "emails." ]
  },
  {
    "thai": "การประชุมทีมของเราเริ่มตอน 9 โมงเช้า",
    "english": "Our team meeting starts at 9 AM.",
    "words": ["Our", "team", "meeting", "starts", "at", "9", "AM." ]
  }],
                office2: [
  {
    "thai": "ฉันพรีเซนต์ความคืบหน้าของโครงการล่าสุด",
    "english": "I present the progress of the latest project.",
    "words": ["I", "present", "the", "progress", "of", "the", "latest", "project." ]
  },
  {
    "thai": "ฉันมักจะจดบันทึกประเด็นสำคัญจากการประชุม",
    "english": "I always take notes of the key points from the meeting.",
    "words": ["I", "always", "take", "notes", "of", "the", "key", "points", "from", "the", "meeting." ]
  },
  {
    "thai": "ฉันทำงานบนคอมพิวเตอร์ตลอดช่วงเช้า",
    "english": "I work on my computer all morning.",
    "words": ["I", "work", "on", "my", "computer", "all", "morning." ]
  },
  {
    "thai": "ฉันรู้สึกหิวตอนเที่ยง",
    "english": "I feel hungry at noon.",
    "words": ["I", "feel", "hungry", "at", "noon." ]
  },
  {
    "thai": "ฉันไปทานข้าวกลางวันกับเพื่อนร่วมงานที่ Terminal 21",
    "english": "I go for lunch with my colleagues at Terminal 21.",
    "words": ["I", "go", "for", "lunch", "with", "my", "colleagues", "at", "Terminal", "21." ]
  },
  {
    "thai": "เราคุยกันเรื่องภาพยนตร์เรื่องใหม่",
    "english": "We talk about the new movie.",
    "words": ["We", "talk", "about", "the", "new", "movie." ]
  },
  {
    "thai": "ฉันซื้อชาไทยเย็นแก้วใหญ่",
    "english": "I buy a big glass of iced Thai tea.",
    "words": ["I", "buy", "a", "big", "glass", "of", "iced", "Thai", "tea." ]
  },
  {
    "thai": "ฉันกลับมาที่ออฟฟิศตอนบ่ายโมงตรง",
    "english": "I get back to the office at 1 PM.",
    "words": ["I", "get", "back", "to", "the", "office", "at", "1", "PM." ]
  },
  {
    "thai": "ฉันทำงานต่อไปจนถึง 5 โมงเย็น",
    "english": "I continue working until 5 PM.",
    "words": ["I", "continue", "working", "until", "5", "PM." ]
  },
  {
    "thai": "หัวหน้าของฉันขอดูรายงานประจำสัปดาห์",
    "english": "My boss asks to see the weekly report.",
    "words": ["My", "boss", "asks", "to", "see", "the", "weekly", "report." ]
  },
  ],
                office3: [
  {
    "thai": "ฉันส่งรายงานให้เขาทางอีเมล",
    "english": "I send the report to him via email.",
    "words": ["I", "send", "the", "report", "to", "him", "via", "email." ]
  },
  {
    "thai": "ฉันปิดคอมพิวเตอร์และเก็บของ",
    "english": "I shut down my computer and pack my things.",
    "words": ["I", "shut", "down", "my", "computer", "and", "pack", "my", "things." ]
  },
  {
    "thai": "ฉันออกเดินทางจากออฟฟิศตอน 6 โมงเย็น",
    "english": "I leave the office at 6 PM.",
    "words": ["I", "leave", "the", "office", "at", "6", "PM." ]
  },
  {
    "thai": "ฉันกลับบ้านด้วยรถไฟฟ้าใต้ดิน MRT",
    "english": "I go home by MRT.",
    "words": ["I", "go", "home", "by", "MRT." ]
  },
  {
    "thai": "ฉันแวะซื้อของกินที่ซูเปอร์มาร์เก็ตก่อนถึงบ้าน",
    "english": "I stop to buy groceries at the supermarket before getting home.",
    "words": ["I", "stop", "to", "buy", "groceries", "at", "the", "supermarket", "before", "getting", "home." ]
  },
  {
    "thai": "ฉันทำอาหารเย็นง่าย ๆ กินเอง",
    "english": "I cook a simple dinner for myself.",
    "words": ["I", "cook", "a", "simple", "dinner", "for", "myself." ]
  },
  {
    "thai": "ฉันดูซีรีส์เกาหลีบน Netflix",
    "english": "I watch a Korean series on Netflix.",
    "words": ["I", "watch", "a", "Korean", "series", "on", "Netflix." ]
  },
  {
    "thai": "ฉันคุยโทรศัพท์กับครอบครัว",
    "english": "I talk on the phone with my family.",
    "words": ["I", "talk", "on", "the", "phone", "with", "my", "family." ]
  },
  {
    "thai": "ฉันเตรียมเสื้อผ้าสำหรับวันพรุ่งนี้",
    "english": "I prepare my clothes for tomorrow.",
    "words": ["I", "prepare", "my", "clothes", "for", "tomorrow." ]
  },
  {
    "thai": "ฉันเข้านอนตอน 4 ทุ่มตรง",
    "english": "I go to bed at 10 PM.",
    "words": ["I", "go", "to", "bed", "at", "10", "PM." ]
  }
],
holliday1: [
  {
    "thai": "เช้านี้ฉันตื่นสายกว่าปกติ",
    "english": "This morning, I woke up later than usual.",
    "words": "This morning, I woke up later than usual.".split(" ")
  },
  {
    "thai": "ฉันรู้สึกสดชื่นและมีพลัง",
    "english": "I feel refreshed and energetic.",
    "words": "I feel refreshed and energetic.".split(" ")
  },
  {
    "thai": "ฉันลงไปซื้ออาหารเช้าที่ตลาดใกล้บ้าน",
    "english": "I went down to buy breakfast at the market near my house.",
    "words": "I went down to buy breakfast at the market near my house.".split(" ")
  },
  {
    "thai": "ฉันวางแผนที่จะทำความสะอาดห้องทั้งหมด",
    "english": "I'm planning to clean my whole room.",
    "words": "I'm planning to clean my whole room.".split(" ")
  },
  {
    "thai": "ฉันเปิดเพลงโปรดฟังในขณะที่จัดระเบียบของ",
    "english": "I turn on my favorite music while organizing my stuff.",
    "words": "I turn on my favorite music while organizing my stuff.".split(" ")
  },
  {
    "thai": "ช่วงบ่ายฉันจะไปเดินเล่นที่สวนสาธารณะ",
    "english": "In the afternoon, I will go for a walk at the public park.",
    "words": "In the afternoon, I will go for a walk at the public park.".split(" ")
  },
  {
    "thai": "อากาศดีมาก ๆ และมีผู้คนจำนวนมาก",
    "english": "The weather is so nice and there are a lot of people.",
    "words": "The weather is so nice and there are a lot of people.".split(" ")
  },
  {
    "thai": "ฉันรู้สึกผ่อนคลายเมื่อได้อยู่ใกล้ชิดกับธรรมชาติ",
    "english": "I feel relaxed when I'm close to nature.",
    "words": "I feel relaxed when I'm close to nature.".split(" ")
  },
  {
    "thai": "ฉันซื้อไอศกรีมกินหนึ่งโคน",
    "english": "I buy an ice cream cone to eat.",
    "words": "I buy an ice cream cone to eat.".split(" ")
  },
  {
    "thai": "หลังจากนั้นฉันเดินไปยังร้านหนังสือ",
    "english": "After that, I walk to the bookstore.",
    "words": "After that, I walk to the bookstore.".split(" ")
  }],
holliday2: [
  {
    "thai": "ฉันใช้เวลาเป็นชั่วโมงในการเลือกหนังสือ",
    "english": "I spend an hour choosing a book.",
    "words": "I spend an hour choosing a book.".split(" ")
  },
  {
    "thai": "ฉันได้หนังสือเล่มใหม่ที่น่าสนใจมาหนึ่งเล่ม",
    "english": "I got a new and interesting book.",
    "words": "I got a new and interesting book.".split(" ")
  },
  {
    "thai": "ช่วงเย็นฉันกลับมาบ้านและอ่านหนังสือ",
    "english": "In the evening, I return home and read the book.",
    "words": "In the evening, I return home and read the book.".split(" ")
  },
  {
    "thai": "ฉันทำอาหารเย็นง่าย ๆ กินเอง",
    "english": "I cook a simple dinner for myself.",
    "words": "I cook a simple dinner for myself.".split(" ")
  },
  {
    "thai": "ฉันดูหนังเรื่องใหม่บน Netflix",
    "english": "I watch a new movie on Netflix.",
    "words": "I watch a new movie on Netflix.".split(" ")
  },
  {
    "thai": "ฉันคุยโทรศัพท์กับเพื่อนสนิท",
    "english": "I talk on the phone with my close friend.",
    "words": "I talk on the phone with my close friend.".split(" ")
  },
  {
    "thai": "เราพูดคุยเรื่องแผนการท่องเที่ยวครั้งหน้า",
    "english": "We talk about the plan for our next trip.",
    "words": "We talk about the plan for our next trip.".split(" ")
  },
  {
    "thai": "ฉันมีความสุขมากในวันนี้",
    "english": "I feel so happy today.",
    "words": "I feel so happy today.".split(" ")
  },
  {
    "thai": "วันหยุดเป็นเวลาที่ดีในการพักผ่อน",
    "english": "The holiday is a great time to rest.",
    "words": "The holiday is a great time to rest.".split(" ")
  },
  {
    "thai": "ฉันเตรียมตัวเข้านอนตอน 4 ทุ่ม",
    "english": "I get ready to go to bed at 10 PM.",
    "words": "I get ready to go to bed at 10 PM.".split(" ")
  }
],
someone1:[
  {
    "thai": "เช้านี้ฉันเห็นเธอที่ร้านกาแฟ",
    "english": "This morning I saw her at the coffee shop.",
    "words": "This morning I saw her at the coffee shop.".split(" ")
  },
  {
    "thai": "เธอสั่งลาเต้ร้อนแก้วเดิมเหมือนทุกวัน",
    "english": "She ordered her usual hot latte, just like every day.",
    "words": "She ordered her usual hot latte, just like every day.".split(" ")
  },
  {
    "thai": "ฉันพยายามที่จะไม่มองเธอมากเกินไป",
    "english": "I tried not to look at her too much.",
    "words": "I tried not to look at her too much.".split(" ")
  },
  {
    "thai": "แต่รอยยิ้มของเธอน่ารักมาก",
    "english": "But her smile is so cute.",
    "words": "But her smile is so cute.".split(" ")
  },
  {
    "thai": "ฉันอยากจะเดินเข้าไปทักทายเธอ",
    "english": "I wanted to walk up and say hi to her.",
    "words": "I wanted to walk up and say hi to her.".split(" ")
  },
  {
    "thai": "แต่ฉันก็อายเกินกว่าจะทำได้",
    "english": "But I was too shy to do it.",
    "words": "But I was too shy to do it.".split(" ")
  },
  {
    "thai": "วันนี้เธอสวมเสื้อสีฟ้าอ่อน",
    "english": "She wore a light blue shirt today.",
    "words": "She wore a light blue shirt today.".split(" ")
  },
  {
    "thai": "สีนั้นเข้ากับเธอมาก ๆ",
    "english": "That color suits her very well.",
    "words": "That color suits her very well.".split(" ")
  },
  {
    "thai": "ฉันแอบมองเธอจากโต๊ะของฉัน",
    "english": "I secretly looked at her from my table.",
    "words": "I secretly looked at her from my table.".split(" ")
  },
  {
    "thai": "ฉันรู้สึกเหมือนหัวใจเต้นแรง",
    "english": "I feel like my heart is beating fast.",
    "words": "I feel like my heart is beating fast.".split(" ")
  }],
someone2:[
  {
    "thai": "ฉันหวังว่าเธอจะสังเกตเห็นฉันบ้าง",
    "english": "I hope she will notice me sometime.",
    "words": "I hope she will notice me sometime.".split(" ")
  },
  {
    "thai": "เพื่อนของฉันบอกให้ฉันกล้า ๆ หน่อย",
    "english": "My friend told me to be braver.",
    "words": "My friend told me to be braver.".split(" ")
  },
  {
    "thai": "แต่มันก็ไม่ง่ายเลย",
    "english": "But it's not easy at all.",
    "words": "But it's not easy at all.".split(" ")
  },
  {
    "thai": "ฉันจินตนาการถึงบทสนทนาของเรา",
    "english": "I imagine a conversation between us.",
    "words": "I imagine a conversation between us.".split(" ")
  },
  {
    "thai": "บางทีพรุ่งนี้ฉันจะลองพูดคุยกับเธอดู",
    "english": "Maybe tomorrow I'll try to talk to her.",
    "words": "Maybe tomorrow I'll try to talk to her.".split(" ")
  },
  {
    "thai": "คืนนี้ฉันคิดถึงแต่เรื่องของเธอ",
    "english": "Tonight, I can only think about her.",
    "words": "Tonight, I can only think about her.".split(" ")
  },
  {
    "thai": "ฉันชอบเวลาที่เธอหัวเราะ",
    "english": "I love it when she laughs.",
    "words": "I love it when she laughs.".split(" ")
  },
  {
    "thai": "มันเป็นเสียงที่เพราะที่สุดในโลก",
    "english": "It's the most beautiful sound in the world.",
    "words": "It's the most beautiful sound in the world.".split(" ")
  },
  {
    "thai": "ฉันหวังว่าฝันของฉันจะมีเธออยู่ด้วย",
    "english": "I hope she is in my dreams.",
    "words": "I hope she is in my dreams.".split(" ")
  },
  {
    "thai": "ฉันควรไปนอนได้แล้ว",
    "english": "I should go to bed now.",
    "words": "I should go to bed now.".split(" ")
  }
]
};

              // Categories data
            $scope.categories = Object.keys($scope.exerciseData).map((key) => ({value: key, label: key}))

            
            // Initialize variables
            $scope.selectedCategory = $scope.categories[0].value;
            $scope.currentExercises = [];
            $scope.hintLevels = {};
            $scope.hintSequences = {};
            $scope.passedExercises = {};
            $scope.progress = 0;
            $scope.totalExercises = 0;
            $scope.totalScore = 0;
            
            // Initialize app
            $scope.init = function() {
                $scope.loadExercises();
            };

            // Fisher-Yates shuffle algorithm for arrays
            $scope.shuffleArray = function(array) {
                var shuffled = [...array]; // Create a copy to avoid modifying original
                for (var i = shuffled.length - 1; i > 0; i--) {
                    var j = Math.floor(Math.random() * (i + 1));
                    var temp = shuffled[i];
                    shuffled[i] = shuffled[j];
                    shuffled[j] = temp;
                }
                return shuffled;
            };
            
            // Generate random sequence for showing words
            $scope.generateRandomSequence = function(length) {
                var indices = [];
                for (var i = 0; i < length; i++) {
                    indices.push(i);
                }
                // Fisher-Yates shuffle algorithm
                for (var i = indices.length - 1; i > 0; i--) {
                    var j = Math.floor(Math.random() * (i + 1));
                    var temp = indices[i];
                    indices[i] = indices[j];
                    indices[j] = temp;
                }
                return indices;
            };
            
            // Load exercises for selected category
            $scope.loadExercises = function() {
                    var originalExercises = $scope.exerciseData[$scope.selectedCategory] || $scope.exerciseData[Object.keys($scope.exerciseData)[0]];
                    $scope.currentExercises = $scope.shuffleArray(originalExercises); // Shuffle the exercises
                    $scope.totalExercises = $scope.currentExercises.length;
                    $scope.hintLevels = {};
                    $scope.hintSequences = {};
                    $scope.passedExercises = {};
                    $scope.progress = 0;
                    $scope.totalScore = 0;
                    
                    // Initialize hint levels and randomized sequences
                    for (var i = 0; i < $scope.currentExercises.length; i++) {
                        $scope.hintLevels[i] = 0; // เริ่มต้นที่ 0 เพื่อซ่อนคำตอบทั้งหมด
                        $scope.passedExercises[i] = false;
                        $scope.hintSequences[i] = $scope.generateRandomSequence($scope.currentExercises[i].words.length);
                    }
                            };
            
            // Get hint button text
            $scope.getHintButtonText = function(index) {
                var level = $scope.hintLevels[index];
                return (5 - level).toString(); // แสดงคะแนนที่จะได้ (5-0=5, 5-1=4, ฯลฯ)
            };
            
            // Get English text with appropriate visibility
            $scope.getEnglishText = function(index) {
                var exercise = $scope.currentExercises[index];
                var level = $scope.hintLevels[index];
                
                if (level === 0) {
                    // Show all words but hidden (invisible text)
                    var displayText = '';
                    for (var i = 0; i < exercise.words.length; i++) {
                        displayText += '<span class="invisible-text">' + exercise.words[i] + '</span> ';
                    }
                    return $sce.trustAsHtml(displayText.trim());
                } else if (level === 5) {
                    return $sce.trustAsHtml(exercise.english);
                } else {
                    // Show progressive hints using randomized sequence
                    var wordsToShow = Math.ceil((exercise.words.length * level) / 5);
                    var randomSequence = $scope.hintSequences[index];
                    var visibleIndices = {};
                    
                    for (var i = 0; i < wordsToShow; i++) {
                        visibleIndices[randomSequence[i]] = true;
                    }
                    
                    var displayText = '';
                    for (var i = 0; i < exercise.words.length; i++) {
                        if (visibleIndices[i]) {
                            displayText += exercise.words[i] + ' ';
                        } else {
                            displayText += '<span class="invisible-text">' + exercise.words[i] + '</span> ';
                        }
                    }
                    
                    return $sce.trustAsHtml(displayText.trim());
                }
            };
            
            // Show hint for specific exercise
            $scope.showHint = function(index) {
                if ($scope.hintLevels[index] < 5) {
                    $scope.hintLevels[index]++; // เพิ่มขึ้นเพื่อแสดง hint มากขึ้น
                }
            };
            
            // Keep exercise (reset hints)
            $scope.keepExercise = function(index) {
                // If this exercise was previously passed, decrease progress and score
                if ($scope.passedExercises[index]) {
                    $scope.progress--;
                    $scope.totalScore -= (5 - $scope.hintLevels[index]); // หักคะแนนที่ได้ไป
                    $scope.passedExercises[index] = false;
                }
                
                $scope.hintLevels[index] = 0; // รีเซ็ตไปที่ 0 เพื่อซ่อนคำตอบทั้งหมด
                // Generate new random sequence when resetting
                var exercise = $scope.currentExercises[index];
                $scope.hintSequences[index] = $scope.generateRandomSequence(exercise.words.length);
            };
            
            // Pass exercise (show full answer and increment progress)
            $scope.passExercise = function(index) {
                var scoreToAdd = 5 - $scope.hintLevels[index]; // คะแนนที่จะได้ = 5 - จำนวนครั้งที่กด hint
                $scope.hintLevels[index] = 5;
                
                // Only increment progress and score if not already passed
                if (!$scope.passedExercises[index]) {
                    $scope.progress++;
                    $scope.totalScore += scoreToAdd;
                    $scope.passedExercises[index] = true;
                }
            };
            
            // Show answer
            $scope.showAnswer = function(index) {
                $scope.hintLevels[index] = 5;
            };
            
            // Get progress percentage
            $scope.getProgressPercentage = function() {
                // Ensure progress doesn't go below 0
                $scope.progress = Math.max(0, $scope.progress);
                return Math.round(($scope.progress / $scope.totalExercises) * 100);
            };
            
            // Refresh exercises
            $scope.refreshExercises = function() {
                $scope.loadExercises();
            };
            
            // Initialize app
            $scope.init();
        }]);
        
        // Service Worker registration for offline functionality
        function registerServiceWorker() {
            if ('serviceWorker' in navigator) {
                var swCode = `
                    const CACHE_NAME = 'english-practice-v1';
                    const urlsToCache = [
                        '/',
                        'data:text/html;charset=utf-8,${encodeURIComponent(document.documentElement.outerHTML)}'
                    ];
                    
                    self.addEventListener('install', event => {
                        event.waitUntil(
                            caches.open(CACHE_NAME)
                                .then(cache => cache.addAll(urlsToCache))
                        );
                    });
                    
                    self.addEventListener('fetch', event => {
                        event.respondWith(
                            caches.match(event.request)
                                .then(response => response || fetch(event.request))
                        );
                    });
                `;
                
                var blob = new Blob([swCode], { type: 'application/javascript' });
                var swUrl = URL.createObjectURL(blob);
                
                navigator.serviceWorker.register(swUrl)
                    .then(function() { console.log('SW registered'); })
                    .catch(function(err) { console.log('SW registration failed'); });
            }
        }
        
        // Register service worker when page loads
        window.addEventListener('load', registerServiceWorker);
    </script>
</body>
</html>