<!DOCTYPE html>
<html lang="th" ng-app="easyTalk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Small talk English Practice</title>


    <!-- PWA Meta Tags -->
<meta name="theme-color" content="#e0f4f3">
<meta name="description" content="Practice English small talk conversations with interactive quizzes">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<meta name="apple-mobile-web-app-title" content="Easy Talk">
<link rel="manifest" href="./manifest.json">


<!-- Apple Touch Icons -->
<link rel="apple-touch-icon" href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTI4IiBoZWlnaHQ9IjEyOCIgdmlld0JveD0iMCAwIDEyOCAxMjgiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHJlY3QgeD0iMTYiIHk9IjE2IiB3aWR0aD0iOTYiIGhlaWdodD0iOTYiIHJ4PSI5IiBmaWxsPSIjODBjNmI1Ii8+PHRleHQgeD0iNjQiIHk9IjQ0IiBmb250LXNpemU9IjI4cHgiIGZpbGw9IiNmZmZmZmYiIGZvbnQtd2VpZ2h0PSJiIj5FPC90ZXh0Pjwvc3ZnPg==">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.8.3/angular.min.js"></script>
     <style>
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

    body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
        background: linear-gradient(180deg, #e0f4f3 0%, #d4eae9 100%);
        min-height: 100vh;
        display: flex;
        flex-direction: column;
        user-select: none;
        -webkit-user-select: none;
    }

    .top-section {
        display: flex;
        gap: 9px;
        justify-content: space-between;
        align-items: center;
        padding: 20px;
        background: rgba(255, 255, 255, 0.1);
    }

    .page-dropdown {
        flex: 1;
        background: #f8f9fa;
        border: none;
        border-radius: 10px;
        padding: 20px 20px;
        width: 100%;
        font-size: 16px;
        color: #495057;
        appearance: none;
        background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='m6 8 4 4 4-4'/%3e%3c/svg%3e");
        background-position: right 12px center;
        background-repeat: no-repeat;
        background-size: 16px;
    }

    .control-buttons {
        display: flex;
        gap: 4px;
    }

    .control-btn {
        width: 50px;
        height: 50px;
        border-radius: 19%;
        border: none;
        font-size: 18px;
        font-weight: bold;
        color: white;
        cursor: pointer;
        transition: transform 0.2s, box-shadow 0.2s;
        background: #80c6b5;
    }

    .control-btn:hover {
        transform: scale(1.1);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    }

    .main-card {
        flex: 1;
        margin: 0 20px;
        background: white;
        border-radius: 20px;
        box-shadow: 0 8px 30px rgba(0, 0, 0, 0.1);
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        padding: 40px 20px;
        position: relative;
        max-height: 94%;
/*        min-height: 400px;*/
    }

    .quiz-question {
        font-size: 28px;
        font-weight: 300;
        color: #333;
        text-align: center;
        margin-bottom: 20px;
        height: 110px;
    }

    .thai-answer {
        font-size: 18px;
        color: #888;
        text-align: center;
        margin-bottom: 40px;
    }

    .score-circle {
        width: 180px;
        height: 180px;
        border-radius: 50%;
        background: #80c6b5;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 64px;
        font-weight: bold;
        color: white;
        margin: 20px auto;
        cursor: pointer;
        top: 50%;
        left: 50%;
    }

    .hints {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        gap: 10px;
        margin: 20px 0;
    }

    .hint-word {
        padding: 8px 16px;
        background: #f0f0f0;
        border-radius: 20px;
        font-size: 16px;
        color: #666;
        opacity: 0;
        transform: scale(0.8);
        transition: all 0.3s ease;
    }

    .hint-word.visible {
        opacity: 1;
        transform: scale(1);
    }

    .action-buttons {
        display: flex;
        gap: 20px;
        margin-top: 30px;
        justify-content: center;
    }

    .action-btn {
        padding: 12px 30px;
        border: none;
        border-radius: 10px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s;
        min-width: 80px;
    }

    .btn-keep {
        background: #ddd;
        color: #666;
    }

    .btn-show {
        background: white;
        color: #80c6b5;
        border: 2px solid #80c6b5;
    }

    .btn-pass {
        background: #80c6b5;
        color: white;
    }

    .action-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    }

    .progress-section {
        padding: 20px;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .progress-info {
        font-size: 18px;
        color: #80c6b5;
        font-weight: 600;
    }

    .progress-bar {
        flex: 1;
        height: 8px;
        background: #ade3d6;
        border-radius: 4px;
        margin: 0 20px;
        overflow: hidden;
    }

    .progress-fill {
        height: 100%;
        background: #80c6b5;
        border-radius: 4px;
        transition: width 0.3s ease;
    }

    .completion-screen {
        text-align: center;
        color: #333;
    }

    .completion-score {
        font-size: 48px;
        font-weight: bold;
        color: #80c6b5;
        margin: 20px 0;
    }

    .restart-btn {
        background: #80c6b5;
        color: white;
        border: none;
        padding: 15px 40px;
        border-radius: 25px;
        font-size: 18px;
        font-weight: 600;
        cursor: pointer;
        margin-top: 20px;
    }

    .quiz-content {
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        flex: 1;
    }

    .card-top {
        display: flex;
        flex-direction: column;
    }

    .container-main {
        display: flex;
        flex-direction: column;
        height: 100vh;
    }

    .container-1 {
        flex: 1;
        display: flex;
        flex-direction: column;
    }
    </style>
</head>
<body ng-controller="QuizController as quiz">

    <div class="container-main">
        <div class="top-section">
            <select class="page-dropdown" 
                    ng-model="quiz.currentPage" 
                    ng-change="quiz.loadCurrentPage()"
                    ng-options="page.value as page.label for page in quiz.pageOptions">
            </select>
            
            <div class="control-buttons">
                <!-- <button class="control-btn btn-m" ng-click="quiz.shuffleQuizzes()">M</button> -->
                <button class="control-btn btn-5" ng-click="quiz.changeItemsPerPage()">{{quiz.itemsPerPage}}</button>
                <button class="control-btn btn-r" ng-click="quiz.resetQuiz()">R</button>
                <!-- <button class="control-btn btn-sound" ng-click="quiz.toggleSound()" title="Toggle Sound">S</button> -->
            </div>
        </div>
        
        <div class="container-1">
            <div class="main-card">
                <div class="quiz-content" ng-show="!quiz.showCompletion">
                    <div class="card-top">
                        <div class="quiz-question" ng-click="quiz.repeatQuestion()" style="cursor: pointer;" title="Click to repeat question">{{quiz.currentQuiz.quiz}}</div>
                        <div class="thai-answer">{{quiz.currentAnswer.thai}}</div>
                        
                        <div class="score-circle" ng-click="quiz.showNextHint()">
                            {{quiz.currentScore}}
                        </div>
                        
                        <div class="hints">
                            <div class="hint-word" 
                                 ng-repeat="word in quiz.hintWords track by $index"
                                 ng-class="{visible: word.visible}">
                                {{word.text}}
                            </div>
                        </div>
                    </div>
                    <div class="action-buttons">
                        <button class="action-btn btn-keep" ng-click="quiz.keepQuestion()">KEEP</button>
                        <button class="action-btn btn-show" ng-click="quiz.showAnswer()">SHOW</button>
                        <button class="action-btn btn-pass" ng-click="quiz.passQuestion()">PASS</button>
                    </div>
                </div>
                
                <div class="completion-screen" ng-show="quiz.showCompletion">
                    <h2>Quiz Completed!</h2>
                    <div class="completion-score">{{quiz.totalScore}} / {{quiz.maxScore}}</div>
                    <div>{{quiz.completionMessage}}</div>
                    <button class="restart-btn" ng-click="quiz.resetQuiz()">Start Again</button>
                </div>
            </div>
            
            <div class="progress-section">
             <!--    <div class="progress-info">
                    <span>{{quiz.progressPercent}} %</span>
                </div> -->
                <div class="progress-bar">
                    <div class="progress-fill" ng-style="{'width': quiz.progressPercent + '%'}"></div>
                </div>
                <div class="progress-info">
                    <span>{{quiz.completedQuestions}} / {{quiz.currentQuizzes.length}}</span>
                    <span style="margin-left: 20px;">({{quiz.totalScore}} POINTS)</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        angular.module('easyTalk', [])
            .service('TextToSpeechService', function() {
                var vm = this;

                vm.speak = function(text, lang, voicesEN) {
                    // ตรวจสอบว่า browser รองรับ Speech Synthesis API หรือไม่
                    if ('speechSynthesis' in window) {
                        // หยุดการพูดที่อาจกำลังทำงานอยู่
                        speechSynthesis.cancel();
                        
                        var utterance = new SpeechSynthesisUtterance(text);
                        console.log({en: voicesEN})

                        const r = Math.floor(Math.random() * 24);
                        console.log(r)

                        // if(voicesEN)
                        // utterance.voice = voicesEN[24];

                        utterance.lang = lang || 'en-US';
                        utterance.rate = 1.0; // ความเร็วในการพูด
                        utterance.pitch = 1; // ระดับเสียง
                        utterance.volume = 0.8; // ระดับความดัง
                        
                        speechSynthesis.speak(utterance);
                    } else {
                        console.log('Text-to-Speech ไม่รองรับใน browser นี้');
                    }
                };
                
                vm.stop = function() {
                    if ('speechSynthesis' in window) {
                        speechSynthesis.cancel();
                    }
                };
            })

            .service('QuizDataService', function() {
                this.getQuizData = function() {
                    return [
   
    {
        "quiz": "Do you have any recommendations for a good cafe around here?",
        "answers": [
            {
                "thai": "มีคาเฟ่ชื่อ The Daily Grind ที่ดีมากอยู่หัวมุมถนน",
                "english": "There's a great cafe called The Daily Grind just around the corner."
            },
            {
                "thai": "ฉันยังไม่เคยสำรวจพื้นที่นี้เลย",
                "english": "I haven't had a chance to explore the area yet."
            },
            {
                "thai": "ฉันแนะนำร้านที่อยู่ตรงข้ามห้องสมุด",
                "english": "I recommend the one right across from the library."
            }
        ]
    },
    {
        "quiz": "What do you do to relax after a long day of classes?",
        "answers": [
            {
                "thai": "ฉันมักจะดูซีรีส์หรือฟังพอดแคสต์",
                "english": "I usually binge-watch a series or listen to podcasts."
            },
            {
                "thai": "ฉันชอบไปเดินเล่นในสวนสาธารณะ",
                "english": "I enjoy taking a walk in the park."
            },
            {
                "thai": "ฉันจะไปเข้ายิมเพื่อออกกำลังกาย",
                "english": "I head to the gym to work out."
            }
        ]
    },
    {
        "quiz": "What kind of music do you listen to when you're studying?",
        "answers": [
            {
                "thai": "ฉันชอบฟังเพลงคลาสสิก มันช่วยให้ฉันผ่อนคลาย",
                "english": "I like classical music; it helps me relax."
            },
            {
                "thai": "ฉันชอบฟังเพลงที่มีจังหวะเร็วๆ",
                "english": "I prefer listening to upbeat music."
            },
            {
                "thai": "ฉันชอบความเงียบมากกว่า",
                "english": "I actually prefer silence."
            }
        ]
    },
    {
        "quiz": "Are you planning to get a part-time job while you're here?",
        "answers": [
            {
                "thai": "ฉันคิดว่าจะลองหาดู อาจจะทำงานในห้องสมุด",
                "english": "I'm thinking of looking for one, maybe at the library."
            },
            {
                "thai": "ไม่ ฉันต้องการเน้นที่การเรียนอย่างเดียว",
                "english": "No, I want to focus on my studies."
            },
            {
                "thai": "ฉันต้องทำงานเพื่อหาเงินค่าใช้จ่าย",
                "english": "I have to work to help with my expenses."
            }
        ]
    },
    {
        "quiz": "What's your favorite food spot on or near campus?",
        "answers": [
            {
                "thai": "ฉันชอบร้านอาหารไทยเล็กๆ ที่อยู่ตรงข้ามมหาวิทยาลัย",
                "english": "I like the small Thai restaurant across the street."
            },
            {
                "thai": "ฉันชอบโรงอาหารของมหาวิทยาลัย",
                "english": "I'm a big fan of the university cafeteria."
            },
            {
                "thai": "ยังไม่แน่ใจเลย ฉันเพิ่งมาใหม่",
                "english": "I'm not sure yet; I'm still new here."
            }
        ]
    },
    {
        "quiz": "What do you do for fun on a Friday night?",
        "answers": [
            {
                "thai": "ฉันมักจะไปดูหนังกับเพื่อนๆ",
                "english": "I usually go see a movie with my friends."
            },
            {
                "thai": "ฉันอยู่บ้านดู Netflix",
                "english": "I stay home and watch Netflix."
            },
            {
                "thai": "ฉันชอบไปเที่ยวกลางคืนที่บาร์",
                "english": "I enjoy going out to a bar."
            }
        ]
    },
    {
        "quiz": "What's your preferred method of transportation?",
        "answers": [
            {
                "thai": "ฉันชอบเดินหรือปั่นจักรยานไปไหนมาไหน",
                "english": "I prefer walking or biking everywhere."
            },
            {
                "thai": "ฉันมักจะนั่งรถประจำทางหรือรถไฟ",
                "english": "I usually take the bus or train."
            },
            {
                "thai": "ฉันขับรถยนต์มาเอง",
                "english": "I drive my own car."
            }
        ]
    },
    {
        "quiz": "What's a fun weekend activity you've done recently?",
        "answers": [
            {
                "thai": "ฉันไปเดินป่าที่อุทยานแห่งชาติกับครอบครัว",
                "english": "I went hiking at a national park with my family."
            },
            {
                "thai": "ฉันไปเที่ยวพิพิธภัณฑ์ศิลปะในตัวเมือง",
                "english": "I visited the art museum downtown."
            },
            {
                "thai": "ฉันไม่ได้ทำอะไรเลย แค่พักผ่อนอยู่บ้าน",
                "english": "I didn't do much, just relaxed at home."
            },

        ]
    },
    // movie
    {
        "quiz": "Are you more into movies or TV series these days?",
        "answers": [
            {
                "thai": "ฉันชอบดูซีรีส์มากกว่า เพราะมันให้เราติดตามเรื่องราวได้นานกว่า",
                "english": "I'm more into TV series because they allow for a longer story."
            },
            {
                "thai": "ฉันชอบดูหนังมากกว่า เพราะมันจบในตอนเดียว ไม่ต้องดูหลายตอน",
                "english": "I prefer movies since they're a complete story in one sitting."
            },
            {
                "thai": "แล้วแต่ช่วงเวลา แต่ช่วงนี้ดูซีรีส์เยอะกว่า",
                "english": "It depends, but I've been watching more series lately."
            }
        ]
    },
    {
        "quiz": "What's the last movie you watched that you would recommend?",
        "answers": [
            {
                "thai": "ฉันเพิ่งดูเรื่อง Parasite แล้วรู้สึกประทับใจมาก",
                "english": "I just watched 'Parasite' and was really impressed."
            },
            {
                "thai": "ฉันแนะนำเรื่อง Everything Everywhere All at Once เลย สนุกมาก",
                "english": "I'd recommend 'Everything Everywhere All at Once'; it was great."
            },
            {
                "thai": "เรื่อง A Quiet Place 2 เป็นหนังที่ดีเลยนะ ถ้าชอบหนังสยองขวัญ",
                "english": "If you like horror, 'A Quiet Place 2' was a good one."
            }
        ]
    },
    {
        "quiz": "What's a TV show you've been binge-watching lately?",
        "answers": [
            {
                "thai": "ฉันติดเรื่อง Stranger Things มากเลย",
                "english": "I'm completely hooked on 'Stranger Things'."
            },
            {
                "thai": "ฉันเพิ่งดู The Crown จบไป แล้วรู้สึกชอบมาก",
                "english": "I just finished 'The Crown' and really enjoyed it."
            },
            {
                "thai": "ตอนนี้ฉันกำลังดู The Last of Us อยู่",
                "english": "I'm currently watching 'The Last of Us'."
            }
        ]
    },
    {
        "quiz": "Do you prefer watching movies at home or at the cinema?",
        "answers": [
            {
                "thai": "ฉันชอบไปดูที่โรงหนังมากกว่า มันให้ความรู้สึกที่ต่างกัน",
                "english": "I prefer going to the cinema; it's a completely different feeling."
            },
            {
                "thai": "ฉันชอบดูที่บ้าน มันสบายกว่า",
                "english": "I like watching at home; it's much more comfortable."
            },
            {
                "thai": "ฉันดูได้ทั้งสองแบบ แล้วแต่โอกาส",
                "english": "I can do both, depending on the occasion."
            }
        ]
    },
    {
        "quiz": "What's a movie or show from your childhood that you still love?",
        "answers": [
            {
                "thai": "ฉันยังคงรักเรื่อง Toy Story เสมอ",
                "english": "I will always love 'Toy Story'."
            },
            {
                "thai": "ฉันชอบเรื่อง Harry Potter มากๆ ดูได้ไม่มีเบื่อ",
                "english": "I'm a big fan of 'Harry Potter'; I can watch it endlessly."
            },
            {
                "thai": "ฉันชอบรายการการ์ตูนเก่าๆ อย่าง Tom and Jerry",
                "english": "I love old cartoons like 'Tom and Jerry'."
            }
        ]
    },
    {
        "quiz": "Do you prefer watching a TV show weekly or binge-watching a whole season?",
        "answers": [
            {
                "thai": "ฉันชอบดูรวดเดียวจบในครั้งเดียวเลย",
                "english": "I like to binge-watch a whole season at once."
            },
            {
                "thai": "ฉันชอบดูสัปดาห์ละตอนมากกว่า มันทำให้ได้ลุ้น",
                "english": "I prefer watching weekly episodes; it keeps the excitement going."
            },
            {
                "thai": "แล้วแต่ว่าเรื่องนั้นน่าสนใจแค่ไหน",
                "english": "It depends on how interesting the show is."
            }
        ]
    },
    {
        "quiz": "What's a popular show that you just couldn't get into?",
        "answers": [
            {
                "thai": "ฉันพยายามดู Game of Thrones แต่ก็ไม่เข้าใจเนื้อเรื่อง",
                "english": "I tried to watch 'Game of Thrones,' but I couldn't get into the story."
            },
            {
                "thai": "ฉันไม่เข้าใจว่าทำไมคนถึงชอบ Friends กันนัก",
                "english": "I don't understand why people love 'Friends' so much."
            },
            {
                "thai": "ฉันชอบหนังและซีรีส์เกือบทุกเรื่อง",
                "english": "I enjoy almost every movie and series I watch."
            }
        ]
    },
    {
        "quiz": "What's your favorite streaming service and why?",
        "answers": [
            {
                "thai": "ฉันชอบ Netflix เพราะมีหนังและซีรีส์ให้เลือกเยอะมาก",
                "english": "I like Netflix because it has a huge selection of movies and series."
            },
            {
                "thai": "ฉันชอบ Disney+ Hotstar เพราะมีหนัง Marvel ที่ฉันชอบ",
                "english": "I like Disney+ Hotstar because it has all the Marvel movies I love."
            },
            {
                "thai": "ฉันใช้บริการหลายแพลตฟอร์ม",
                "english": "I use several different platforms."
            }
        ]
    },
    {
        "quiz": "Have you ever re-watched a movie or a series multiple times?",
        "answers": [
            {
                "thai": "ใช่ ฉันดู Lord of the Rings ซ้ำหลายครั้งเลย",
                "english": "Yes, I've re-watched 'Lord of the Rings' many times."
            },
            {
                "thai": "ฉันไม่ค่อยดูหนังซ้ำเท่าไหร่",
                "english": "I don't really re-watch movies."
            },
            {
                "thai": "ฉันดูซ้ำเฉพาะตอนที่ชอบเท่านั้น",
                "english": "I only re-watch my favorite parts."
            }
        ]
    },
    {
        "quiz": "What's a movie genre you don't usually watch but would like to explore?",
        "answers": [
            {
                "thai": "ฉันไม่ค่อยดูหนังสยองขวัญ แต่ก็อยากลองดู",
                "english": "I don't usually watch horror, but I'd like to try."
            },
            {
                "thai": "ฉันไม่ค่อยดูหนังวิทยาศาสตร์เท่าไหร่",
                "english": "I don't watch a lot of science fiction."
            },
            {
                "thai": "ฉันดูหนังทุกประเภทเลย",
                "english": "I watch pretty much every genre."
            }
        ]
    },
    {
        "quiz": "What's the best animated movie you've ever seen?",
        "answers": [
            {
                "thai": "ฉันคิดว่า Spirited Away เป็นหนังแอนิเมชันที่ดีที่สุด",
                "english": "I think 'Spirited Away' is the best animated movie."
            },
            {
                "thai": "ฉันชอบ Spider-Man: Into the Spider-Verse",
                "english": "I really love 'Spider-Man: Into the Spider-Verse'."
            },
            {
                "thai": "ฉันชอบหนังแอนิเมชันของ Disney ทุกเรื่องเลย",
                "english": "I love all of Disney's animated movies."
            }
        ]
    },
    // Food and cooking
    {
        "quiz": "What’s your favorite dish to cook for yourself?",
        "answers": [
            {
                "thai": "ฉันชอบทำข้าวผัดง่ายๆ",
                "english": "I enjoy making a simple fried rice."
            },
            {
                "thai": "ฉันไม่ค่อยทำอาหารเท่าไหร่",
                "english": "I don't really cook much."
            },
            {
                "thai": "ฉันชอบทำพาสต้าคาโบนาร่า",
                "english": "I like to make pasta carbonara."
            }
        ]
    },
    {
        "quiz": "Do you prefer eating out at a restaurant or cooking at home?",
        "answers": [
            {
                "thai": "ฉันชอบกินข้าวนอกบ้านเพื่อลองอาหารใหม่ๆ",
                "english": "I prefer eating out to try new food."
            },
            {
                "thai": "ฉันชอบทำอาหารที่บ้านมากกว่า มันประหยัดกว่า",
                "english": "I like cooking at home more; it's cheaper."
            },
            {
                "thai": "แล้วแต่วันนะ บางวันก็อยากออกไปข้างนอก",
                "english": "It depends on the day, sometimes I want to go out."
            }
        ]
    },
    {
        "quiz": "What’s a food you've always wanted to try?",
        "answers": [
            {
                "thai": "ฉันอยากลองอาหารโมเลกุลที่ร้านอาหารหรูๆ",
                "english": "I'd love to try molecular gastronomy at a fancy restaurant."
            },
            {
                "thai": "ฉันไม่ค่อยกล้าลองอาหารแปลกๆ",
                "english": "I'm not very adventurous with food."
            },
            {
                "thai": "ฉันอยากลองกินทุเรียน",
                "english": "I want to try durian."
            }
        ]
    },
    {
        "quiz": "Do you have a favorite restaurant you like to go to?",
        "answers": [
            {
                "thai": "ฉันชอบร้านอาหารญี่ปุ่นเล็กๆ แถวบ้าน",
                "english": "I like a small Japanese restaurant near my place."
            },
            {
                "thai": "ฉันยังไม่มีร้านโปรดเลย",
                "english": "I don't have a favorite restaurant yet."
            },
            {
                "thai": "ฉันไปที่ร้านพิซซ่าเดิมๆ เสมอ",
                "english": "I always go to the same pizza place."
            }
        ]
    },
    {
        "quiz": "What's a common dish from your country that you think everyone should try?",
        "answers": [
            {
                "thai": "ทุกคนควรลองกินต้มยำกุ้ง",
                "english": "Everyone should try Tom Yum Goong."
            },
            {
                "thai": "ฉันแนะนำผัดไทย",
                "english": "I recommend Pad Thai."
            },
            {
                "thai": "ข้าวเหนียวมะม่วงเป็นขนมหวานที่อร่อยมาก",
                "english": "Mango sticky rice is a great dessert."
            }
        ]
    },
    {
        "quiz": "Are you a fan of spicy food?",
        "answers": [
            {
                "thai": "ใช่ ฉันชอบอาหารรสจัดมาก",
                "english": "Yes, I'm a big fan of spicy food."
            },
            {
                "thai": "ไม่ค่อยชอบเท่าไหร่ ฉันกินเผ็ดได้นิดหน่อย",
                "english": "Not really; I can only handle a little bit of spice."
            },
            {
                "thai": "ฉันกินเผ็ดไม่ได้เลย",
                "english": "I can't eat spicy food at all."
            }
        ]
    },
    {
        "quiz": "What's the best meal you've ever had?",
        "answers": [
            {
                "thai": "เป็นสเต็กเนื้อที่ฉันกินตอนไปเที่ยวอาร์เจนตินา",
                "english": "It was a beef steak I had on my trip to Argentina."
            },
            {
                "thai": "เป็นอาหารที่แม่ของฉันทำ มันอร่อยที่สุดเสมอ",
                "english": "It was a meal my mom cooked; it's always the best."
            },
            {
                "thai": "ฉันไม่แน่ใจ แต่เป็นอาหารจากร้านอาหารอิตาเลียน",
                "english": "I'm not sure, but it was at an Italian restaurant."
            }
        ]
    },
    {
        "quiz": "Do you have a secret family recipe?",
        "answers": [
            {
                "thai": "ใช่ มีสูตรพริกแกงที่สืบทอดกันมา",
                "english": "Yes, we have a secret family curry paste recipe."
            },
            {
                "thai": "ไม่ ฉันคิดว่าทุกคนทำอาหารเหมือนกันหมด",
                "english": "No, I think everyone cooks the same way."
            },
            {
                "thai": "มีสูตรคุกกี้ช็อกโกแลตชิพที่พิเศษมาก",
                "english": "There's a special chocolate chip cookie recipe."
            }
        ]
    },
    {
        "quiz": "What’s your go-to comfort food?",
        "answers": [
            {
                "thai": "เป็นซุปไก่กับผักร้อนๆ",
                "english": "It's a bowl of hot chicken soup with vegetables."
            },
            {
                "thai": "ฉันชอบกินไอศกรีมวานิลลา",
                "english": "I like to eat vanilla ice cream."
            },
            {
                "thai": "ข้าวเหนียวมะม่วง",
                "english": "Mango sticky rice."
            }
        ]
    },
    {
        "quiz": "Have you ever tried to cook something new that didn't go well?",
        "answers": [
            {
                "thai": "ใช่ ฉันพยายามทำพิซซ่าโฮมเมดแต่แป้งออกมาแข็งมาก",
                "english": "Yes, I tried to make homemade pizza but the dough turned out very hard."
            },
            {
                "thai": "ไม่เลย ทุกอย่างที่ฉันทำออกมาดีเสมอ",
                "english": "No, everything I've cooked has always turned out well."
            },
            {
                "thai": "ฉันทำเค้กช็อกโกแลต แต่รสชาติไม่ค่อยอร่อย",
                "english": "I made a chocolate cake, but it didn't taste very good."
            }
        ]
    },
    {
        "quiz": "What kitchen gadget can you not live without?",
        "answers": [
            {
                "thai": "เครื่องปั่นผลไม้ มันเป็นสิ่งที่จำเป็นมาก",
                "english": "A blender. It's an absolute essential."
            },
            {
                "thai": "หม้อหุงข้าว มันทำให้ชีวิตง่ายขึ้นมาก",
                "english": "A rice cooker. It makes life so much easier."
            },
            {
                "thai": "ฉันใช้แค่มีดกับเขียงก็พอแล้ว",
                "english": "I just need a knife and a cutting board."
            }
        ]
    },
    {
        "quiz": "What’s a food trend you don’t understand?",
        "answers": [
            {
                "thai": "อาหารที่หน้าตาแปลกๆ อย่างอาหารผสมสี",
                "english": "Foods that look weird, like rainbow-colored food."
            },
            {
                "thai": "ฉันไม่เข้าใจทำไมคนถึงชอบกินอาหารวีแกน",
                "english": "I don't understand why people like to eat vegan food."
            },
            {
                "thai": "อาหารที่ใส่ทองคำเปลว",
                "english": "Food with gold flakes."
            }
        ]
    },
    {
        "quiz": "Do you have any dietary restrictions?",
        "answers": [
            {
                "thai": "ฉันเป็นมังสวิรัติ",
                "english": "I'm a vegetarian."
            },
            {
                "thai": "ฉันแพ้ถั่วลิสง",
                "english": "I'm allergic to peanuts."
            },
            {
                "thai": "ไม่เลย ฉันกินได้ทุกอย่าง",
                "english": "No, I can eat anything."
            }
        ]
    },
    {
        "quiz": "What’s your favorite type of cuisine?",
        "answers": [
            {
                "thai": "ฉันชอบอาหารอิตาเลียนมากที่สุด",
                "english": "I like Italian cuisine the most."
            },
            {
                "thai": "ฉันชอบอาหารเกาหลี",
                "english": "I enjoy Korean food."
            },
            {
                "thai": "ฉันชอบอาหารจีน",
                "english": "I prefer Chinese food."
            }
        ]
    },
    {
        "quiz": "What food do you always have in your fridge?",
        "answers": [
            {
                "thai": "ไข่และนม",
                "english": "Eggs and milk."
            },
            {
                "thai": "โยเกิร์ตและผัก",
                "english": "Yogurt and vegetables."
            },
            {
                "thai": "ชีสและไวน์",
                "english": "Cheese and wine."
            }
        ]
    },
    {
        "quiz": "Who taught you how to cook?",
        "answers": [
            {
                "thai": "แม่ของฉัน",
                "english": "My mom."
            },
            {
                "thai": "ฉันเรียนรู้ด้วยตัวเองจากวิดีโอ YouTube",
                "english": "I taught myself from YouTube videos."
            },
            {
                "thai": "ฉันเรียนจากคุณย่าของฉัน",
                "english": "My grandmother taught me."
            }
        ]
    },
    {
        "quiz": "What’s your favorite dessert?",
        "answers": [
            {
                "thai": "ฉันชอบเค้กช็อกโกแลต",
                "english": "I love chocolate cake."
            },
            {
                "thai": "ไอศกรีม",
                "english": "Ice cream."
            },
            {
                "thai": "บราวนี่",
                "english": "Brownies."
            }
        ]
    },
    {
        "quiz": "Do you like to bake?",
        "answers": [
            {
                "thai": "ใช่ ฉันชอบทำขนมปังและเค้ก",
                "english": "Yes, I enjoy baking bread and cakes."
            },
            {
                "thai": "ไม่ค่อยชอบเท่าไหร่ มันยุ่งยากเกินไป",
                "english": "Not really; it's too much work."
            },
            {
                "thai": "ฉันอยากลองทำนะ แต่ไม่รู้จะเริ่มจากตรงไหน",
                "english": "I want to try, but I don't know where to start."
            }
        ]
    },
    {
        "quiz": "What's a cooking skill you'd like to learn?",
        "answers": [
            {
                "thai": "ฉันอยากเรียนรู้วิธีการทำอาหารไทยแบบต้นตำรับ",
                "english": "I'd like to learn how to make authentic Thai food."
            },
            {
                "thai": "ฉันอยากเรียนทำอาหารฝรั่งเศส",
                "english": "I want to learn French cooking."
            },
            {
                "thai": "ฉันอยากเรียนรู้วิธีการทำอาหารญี่ปุ่น",
                "english": "I want to learn Japanese cooking."
            }
        ]
    }

];
                };
                
                this.shuffleArray = function(array) {
                    var shuffled = angular.copy(array);
                    for (var i = shuffled.length - 1; i > 0; i--) {
                        var j = Math.floor(Math.random() * (i + 1));
                        var temp = shuffled[i];
                        shuffled[i] = shuffled[j];
                        shuffled[j] = temp;
                    }
                    return shuffled;
                };
            })

            .controller('QuizController', ['QuizDataService', 'TextToSpeechService', '$timeout', function(QuizDataService, TextToSpeechService, $timeout) {
                var vm = this;
                
                // Initialize data
                vm.quizData = QuizDataService.getQuizData();
                vm.shuffledQuizData = angular.copy(vm.quizData);
                vm.currentQuizzes = [];
                vm.availableQuizzes = [];
                vm.currentQuiz = {};
                vm.currentAnswer = {};
                vm.hintWords = [];
                vm.randomHintOrder = [];
                
                // State variables
                vm.currentPage = 0;
                vm.itemsPerPage = 5;
                vm.currentHintLevel = 0;
                vm.currentScore = 5;
                vm.totalScore = 0;
                vm.completedQuestions = 0;
                vm.showCompletion = false;
                vm.pageOptions = [];
                vm.soundEnabled = true; // เปิดเสียงเป็นค่าเริ่มต้น
                
                // Computed properties
                vm.progressPercent = 0;
                vm.maxScore = 0;
                vm.completionMessage = '';
                
                // Initialize the app
                vm.init = function() {
                    // vm.shuffleQuizzes();
                    vm.updatePageDropdown();
                    vm.loadCurrentPage();
                    console.log({
                            currentQuizzes: vm.currentQuizzes,
                            availableQuizzes: vm.availableQuizzes,
                            currentQuiz: vm.currentQuiz,
                            currentAnswer: vm.currentAnswer,
                            hintWords:vm.hintWords,
                    });
                };
                
                vm.shuffleQuizzes = function() {
                    vm.shuffledQuizData = QuizDataService.shuffleArray(vm.quizData);
                    vm.updatePageDropdown();
                    vm.loadCurrentPage();
                };
                
                vm.changeItemsPerPage = function() {
                    vm.itemsPerPage += 5;
                    if (vm.itemsPerPage > 20) {
                        vm.itemsPerPage = 5;
                    }
                    vm.resetQuiz();
                };
                
                vm.resetQuiz = function() {
                    vm.currentPage = 0;
                    vm.totalScore = 0;
                    vm.completedQuestions = 0;
                    vm.showCompletion = false;
                    vm.init();
                    // vm.shuffleQuizzes();
                };
                
                vm.updatePageDropdown = function() {
                    var totalPages = Math.ceil(vm.shuffledQuizData.length / vm.itemsPerPage);
                    vm.pageOptions = [];
                    
                    for (var i = 0; i < totalPages; i++) {
                        var startNum = (i * vm.itemsPerPage) + 1;
                        var endNum = Math.min((i + 1) * vm.itemsPerPage, vm.shuffledQuizData.length);
                        vm.pageOptions.push({
                            value: i,
                            label: 'Page ' + (i + 1) + ' (' + startNum + '-' + endNum + ')'
                        });
                    }
                };
                
                vm.loadCurrentPage = function() {
                    var startIndex = vm.currentPage * vm.itemsPerPage;
                    var endIndex = Math.min(startIndex + vm.itemsPerPage, vm.shuffledQuizData.length);
                    
                    console.log({startIndex, endIndex});
                    var existItem = [];

                    // สร้าง currentQuizzes จากการสุ่มเลือกโจทย์และคำตอบ
                    vm.currentQuizzes = Array.from({length: vm.itemsPerPage}).map(function() {

                        var numberItem = "";
                        var randomQuizIndex = 0;
                        var selectedQuiz = {}
                        var randomAnswer = 0;

                        // สุ่ม index ในขอบเขตของ page (0-4 สำหรับ page 1, 5-9 สำหรับ page 2, etc.)

                        do {
                       
                            randomQuizIndex = startIndex + Math.floor(Math.random() * (endIndex - startIndex));
                            selectedQuiz = vm.shuffledQuizData[randomQuizIndex];
                            randomAnswer = Math.floor(Math.random() * selectedQuiz.answers.length);
                            
                            numberItem = `${randomQuizIndex}${randomAnswer}`

                            console.log({numberItem})
                            
                        } while(existItem.includes(numberItem))

                            existItem = [...existItem, numberItem];
                            return {
                                quiz: selectedQuiz.quiz,
                                thai: selectedQuiz.answers[randomAnswer].thai,
                                english: selectedQuiz.answers[randomAnswer].english
                            };
                       
                    });

                    console.log({existItem})
                    
                    vm.availableQuizzes = angular.copy(vm.currentQuizzes);
                    vm.completedQuestions = 0;
                    vm.totalScore = 0;
                    vm.loadCurrentQuestion();
                };
                
                vm.loadCurrentQuestion = function() {
                    if (vm.availableQuizzes.length === 0) {
                        vm.showCompletionScreen();
                        return;
                    }
                    
                    // Random select from available quizzes
                    var randomIndex = Math.floor(Math.random() * vm.availableQuizzes.length);
                    console.log({randomIndex})
                    vm.currentQuiz = vm.availableQuizzes[randomIndex];
                    vm.currentAnswer = {
                        thai: vm.currentQuiz.thai,
                        english: vm.currentQuiz.english
                    };
                    
                    vm.currentHintLevel = 0;
                    vm.currentScore = 5;
                    
                    vm.setupHints();
                    
                    
                    // อ่านโจทย์ออกเสียงเมื่อเริ่มข้อใหม่ (เฉพาะเมื่อเปิดเสียง)
                    if (vm.soundEnabled) {
                        $timeout(function() {
                            TextToSpeechService.speak(vm.currentQuiz.quiz, 'en-US', vm.voicesEN);
                        }, 300); // หน่วงเวลาเล็กน้อยเพื่อให้ UI อัพเดทก่อน
                    }
                };
                
                vm.setupHints = function() {
                    var words = vm.currentAnswer.english.split(' ');
                    vm.hintWords = [];
                    
                    // Create random order for hints
                    vm.randomHintOrder = [];
                    for (var i = 0; i < words.length; i++) {
                        vm.randomHintOrder.push(i);
                        vm.hintWords.push({
                            text: words[i],
                            visible: false
                        });
                    }
                    
                    // Shuffle the order
                    vm.randomHintOrder = QuizDataService.shuffleArray(vm.randomHintOrder);
                };
                
                vm.showNextHint = function() {
                    if (vm.currentHintLevel < 5) {
                        vm.currentHintLevel++;
                        var wordsToShow = Math.ceil((vm.hintWords.length * vm.currentHintLevel) / 5);
                        
                        // Show hints in random order
                        for (var i = 0; i < wordsToShow && i < vm.randomHintOrder.length; i++) {
                            var wordIndex = vm.randomHintOrder[i];
                            if (vm.hintWords[wordIndex]) {
                                vm.hintWords[wordIndex].visible = true;
                            }
                        }
                        
                        vm.currentScore = Math.max(0, 5 - vm.currentHintLevel);
                    }
                };
                
                vm.keepQuestion = function() {

                    console.log({
                            currentQuizzes: vm.currentQuizzes,
                            availableQuizzes: vm.availableQuizzes,
                            currentQuiz: vm.currentQuiz,
                            currentAnswer: vm.currentAnswer,
                            hintWords:vm.hintWords,
                    });

                    // หยุดการอ่านออกเสียงที่อาจกำลังทำงานอยู่
                    // TextToSpeechService.stop();
                    // TextToSpeechService.speak(vm.currentAnswer.english, 'en-US');


                    
                    // Reset hints but don't remove the question from available pool
                    vm.currentHintLevel = 0;
                    vm.currentScore = 5;
                    vm.setupHints();

                    $timeout(function() {
                        vm.loadCurrentQuestion();
                    }, 500);

                    // Load next random question (keep current question in pool)
                    // vm.loadCurrentQuestion();
                };
                
                vm.showAnswer = function() {

                    vm.currentHintLevel = 5;
                    vm.currentScore = 0;
                    for (var i = 0; i < vm.hintWords.length; i++) {
                        vm.hintWords[i].visible = true;
                    }
                    TextToSpeechService.speak(vm.currentAnswer.english, 'en-US');
                };
                
                vm.passQuestion = function() {
                    // หยุดการอ่านออกเสียงที่อาจกำลังทำงานอยู่
                    // TextToSpeechService.stop();
                    // TextToSpeechService.speak(vm.currentAnswer.english, 'en-US');
                    vm.completedQuestions++;
                    var score = Math.max(0, 5 - vm.currentHintLevel);
                    vm.totalScore += score;
                    vm.updateProgress();
                    
                    // Remove current question from available pool
                    var index = vm.availableQuizzes.findIndex(function(q) {
                        return q.quiz === vm.currentQuiz.quiz;
                    });
                    if (index !== -1) {
                        vm.availableQuizzes.splice(index, 1);
                    }

                    console.log({
                            currentQuizzes: vm.currentQuizzes,
                            availableQuizzes: vm.availableQuizzes,
                            currentQuiz: vm.currentQuiz,
                            currentAnswer: vm.currentAnswer,
                            hintWords:vm.hintWords,
                    });
                    
                    // vm.showAnswer();
                    
                    $timeout(function() {
                        vm.loadCurrentQuestion();
                    }, 100);
                };
                
                vm.updateProgress = function() {
                    vm.progressPercent = Math.round((vm.completedQuestions / vm.currentQuizzes.length) * 100);
                };
                
                vm.showCompletionScreen = function() {
                    vm.showCompletion = true;
                    vm.maxScore = vm.currentQuizzes.length * 5;
                    
                    var percentage = Math.round((vm.totalScore / vm.maxScore) * 100);
                    if (percentage >= 80) {
                        vm.completionMessage = 'Excellent!';
                    } else if (percentage >= 60) {
                        vm.completionMessage = 'Good job!';
                    } else if (percentage >= 40) {
                        vm.completionMessage = 'Keep practicing!';
                    } else {
                        vm.completionMessage = 'Try again!';
                    }
                };
                
                // vm.toggleSound = function() {
                //     vm.soundEnabled = !vm.soundEnabled;
                //     if (!vm.soundEnabled) {
                //         TextToSpeechService.stop();
                //     }
                // };
                
                vm.repeatQuestion = function() {
                    if (vm.soundEnabled && vm.currentQuiz && vm.currentQuiz.quiz) {
                        TextToSpeechService.speak(vm.currentQuiz.quiz, 'en-US');
                    }
                };


                // ฟังก์ชันโหลด voices
                vm.initVoices = function() {
                    const loadVoices = () => {
                        const voices = window.speechSynthesis.getVoices();
                        console.log('Loading voices:', voices.length, voices);
                        
                        if (voices.length > 0) {
                            vm.voicesEN = voices.filter(v => v.lang.includes("en-US"));
                            vm.voicesTH = voices.filter(v => v.lang === "th-TH");
                            vm.voicesLoaded = true;
                            
                            console.log('Voices loaded successfully:', {EN: vm.voicesEN, TH: vm.voicesTH});
                            vm.$apply(); // อัปเดต Angular scope
                        }
                    };

                    // ลองโหลดทันที (กรณีที่ voices พร้อมแล้ว)
                    // loadVoices();
                    
                    // ลงทะเบียน event listener สำหรับเมื่อ voices พร้อม
                    if (window.speechSynthesis.onvoiceschanged !== undefined) {
                        window.speechSynthesis.onvoiceschanged = loadVoices;
                    }
                    
                    // วิธีสำรอง: ใช้ timeout เผื่อ event ไม่ทำงาน
                    $timeout(() => {
                        if (!vm.voicesLoaded) {
                            console.log('Fallback: Loading voices after timeout');
                            loadVoices();
                        }
                    }, 1000);
                };
                
                // Initialize the app
                vm.init();
                vm.initVoices();

                // Service Worker registration for offline functionality
        // function registerServiceWorker() {
        //     if ('serviceWorker' in navigator) {
        //         var swCode = `
        //             const CACHE_NAME = 'easy-talk';
        //             const urlsToCache = [
        //                 '/',
        //                 'data:text/html;charset=utf-8,${encodeURIComponent(document.documentElement.outerHTML)}'
        //             ];
                    
        //             self.addEventListener('install', event => {
        //                 event.waitUntil(
        //                     caches.open(CACHE_NAME)
        //                         .then(cache => cache.addAll(urlsToCache))
        //                 );
        //             });
                    
        //             self.addEventListener('fetch', event => {
        //                 event.respondWith(
        //                     caches.match(event.request)
        //                         .then(response => response || fetch(event.request))
        //                 );
        //             });
        //         `;
                
        //         var blob = new Blob([swCode], { type: 'application/javascript' });
        //         var swUrl = URL.createObjectURL(blob);
                
        //         navigator.serviceWorker.register(swUrl)
        //             .then(function() { console.log('SW registered'); })
        //             .catch(function(err) { console.log('SW registration failed'); });
        //     }
        // }
        
        // // Register service worker when page loads
        // window.addEventListener('load', registerServiceWorker);
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('sw.js')
                    .then(registration => console.log('SW registered'))
                    .catch(error => console.log('SW registration failed'));
            });
        }

            }]);

        
    </script>
</body>
</html>